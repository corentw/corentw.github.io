<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KI-Chat (Automatisches Lernen)</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background-color: #f4f4f9; }
    #chat {
      max-width: 600px;
      margin: auto;
      background: #ffffff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .message { margin-bottom: 10px; padding: 10px; border-radius: 5px; }
    .user-message { text-align: right; background-color: #e1ffc7; }
    .bot-message { text-align: left; background-color: #e0f0ff; }
    input[type="text"] { padding: 10px; width: 80%; margin-right: 10px; border-radius: 5px; }
    button { padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 5px; }
    button:hover { background-color: #0056b3; }
    .option-button { margin-top: 10px; }
  </style>
</head>
<body>
  <div id="chat">
    <div class="message bot-message">Hallo! Ich kann nach Wetter, Bitcoin-Preis, Nachrichten und mehr suchen. Womit soll ich beginnen?</div>
    <div>
      <input type="text" id="userInput" placeholder="Gib hier deine Nachricht ein" />
      <button onclick="sendMessage()">Senden</button>
    </div>
    <div id="options">
      <button class="option-button" onclick="sendMessage('Wetter')">Wetter</button>
      <button class="option-button" onclick="sendMessage('Bitcoin')">Bitcoin-Preis</button>
      <button class="option-button" onclick="sendMessage('Nachrichten')">Nachrichten</button>
    </div>
    <div id="status"></div>
  </div>

  <script>
    // Datenbank im LocalStorage speichern
    let database = {
      "web_data": [],
      "query_count": 0,
      "learned_data": {}  // Hier speichern wir gelerntes Wissen
    };

    // Initialisieren, wenn noch keine Daten vorhanden sind
    if (!localStorage.getItem('database')) {
      localStorage.setItem('database', JSON.stringify(database));
    } else {
      database = JSON.parse(localStorage.getItem('database'));
    }

    // Nachricht senden
    function sendMessage(userInput = '') {
      const input = userInput || document.getElementById('userInput').value;
      if (input) {
        appendMessage(input, 'user-message');
        processMessage(input);
      }
    }

    // Nachricht im Chat anzeigen
    function appendMessage(message, className) {
      let div = document.createElement('div');
      div.classList.add('message', className);
      div.innerHTML = message;
      document.getElementById('chat').appendChild(div);
      document.getElementById('userInput').value = '';
    }

    // Nachricht verarbeiten
    function processMessage(userMessage) {
      // Prüfen, ob wir bereits etwas gelernt haben, das zur Anfrage passt
      const learnedResponse = getLearnedResponse(userMessage);
      if (learnedResponse) {
        appendMessage(learnedResponse, 'bot-message');
      } else {
        // Wenn keine Antwort gefunden wurde, API-Anfragen ausführen
        if (userMessage.toLowerCase().includes("wetter")) {
          getWeatherData(userMessage);
        } else if (userMessage.toLowerCase().includes("bitcoin")) {
          getBitcoinPrice(userMessage);
        } else if (userMessage.toLowerCase().includes("nachrichten")) {
          getNewsData();
        } else {
          appendMessage("Ich kann nur nach dem Wetter, Bitcoin-Preis oder Nachrichten fragen.", 'bot-message');
        }
      }
    }

    // Prüfen, ob wir eine passende, gelernte Antwort haben
    function getLearnedResponse(userMessage) {
      const normalizedMessage = userMessage.toLowerCase().trim();
      return database.learned_data[normalizedMessage] || null;
    }

    // Wetter-Daten abrufen (OpenWeatherMap API)
    function getWeatherData(userMessage) {
      const city = userMessage.match(/wetter in (\w+)/i);
      if (city) {
        fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city[1]}&appid=dein-api-schlüssel&units=metric&lang=de`)
          .then(response => response.json())
          .then(data => {
            if (data.cod === 200) {
              const weatherInfo = `Aktuelles Wetter in ${city[1]}: ${data.weather[0].description}, ${data.main.temp}°C`;
              saveToDatabase(userMessage, weatherInfo);
              appendMessage(weatherInfo, 'bot-message');
            } else {
              appendMessage(`Es konnte keine Wetterinformation für ${city[1]} gefunden werden.`, 'bot-message');
            }
          })
          .catch(error => appendMessage('Fehler beim Abrufen der Wetterdaten.', 'bot-message'));
      } else {
        appendMessage("Bitte gib die Stadt an, für die du das Wetter wissen möchtest (z.B. 'Wetter in Berlin').", 'bot-message');
      }
    }

    // Bitcoin-Preis-Daten abrufen (CoinDesk API)
    function getBitcoinPrice(userMessage) {
      fetch('https://api.coindesk.com/v1/bpi/currentprice/BTC.json')
        .then(response => response.json())
        .then(data => {
          const bitcoinPrice = `Aktueller Bitcoin-Preis: ${data.bpi.USD.rate} USD`;
          saveToDatabase(userMessage, bitcoinPrice);
          appendMessage(bitcoinPrice, 'bot-message');
        })
        .catch(error => appendMessage('Fehler beim Abrufen der Bitcoin-Daten.', 'bot-message'));
    }

    // Nachrichten-Daten abrufen (News API)
    function getNewsData() {
      fetch('https://newsapi.org/v2/top-headlines?country=de&apiKey=dein-api-schlüssel')
        .then(response => response.json())
        .then(data => {
          let newsInfo = 'Top Nachrichten:\n';
          data.articles.slice(0, 3).forEach(article => {
            newsInfo += `${article.title} - ${article.description}\n`;
          });
          saveToDatabase('Nachrichten', newsInfo);
          appendMessage(newsInfo.replace(/\n/g, '<br>'), 'bot-message');
        })
        .catch(error => appendMessage('Fehler beim Abrufen der Nachrichten.', 'bot-message'));
    }

    // Speichern der Daten in der Datenbank
    function saveToDatabase(question, answer) {
      const normalizedQuestion = question.toLowerCase().trim();
      const newEntry = { 
        question: question, 
        answer: answer, 
        timestamp: new Date().toISOString() 
      };
      database.web_data.push(newEntry);

      // Lernen: Speichern der Antwort für zukünftige ähnliche Anfragen
      database.learned_data[normalizedQuestion] = answer;

      database.query_count++;
      localStorage.setItem('database', JSON.stringify(database));
    }

    // Speichern der Daten als JSON-Datei
    function saveJsonData() {
      const jsonData = JSON.stringify(database, null, 2);
      const blob = new Blob([jsonData], { type: 'application/json' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = `web_data_${new Date().toISOString()}.json`;
      link.click();
      appendMessage('Daten wurden als JSON-Datei gespeichert.', 'bot-message');
    }
  </script>
</body>
</html>
